<!DOCTYPE html>
<html>
<head>
    <style>
        body
            {
            font-family:tahoma
            }
        /* headerDiv class - div for pages header, scrolls down with  */
        .headerDiv{
            background: #1abc9c;
            color: white;
            font-size: 30px;
            width: 100%;
            display: block;
            position:sticky;
            text-align:center;
            top:0;
            }
        /* maindDiv class- div for containing rest of html page elements*/
        .mainDiv{
            margin:5px;
            padding:5px;
        }
        /* homeLink - ahref for link to home, want it perfectly centered*/
        #homeLink{
            position:relative;
        }

        #loginLink{
            position:absolute;
            left: 1%;
        }
        #logoutLink{
            position:absolute;
            right: 1%;
        }
        .headerP{
            padding:0;
            margin:0;
            }
        html{ padding:0;
            margin:0;
            }
        body{ padding:0;
            margin:0;
            }
        p{
            color:white;
        }
        #d3SettingsContainerDiv{
            display: inline-block; 
            position: relative;
            border-radius: 5px;
            background-color:#343d46;
            padding: 20px;
        }

    </style>
    <title>Generic Site HomePage</title>
</head>
<body>
    <div class="headerDiv">

        <a id="loginLink" href="login.html">Login</a>
        <a id="homeLink" href="home.html">Home</a>
        <a id="logoutLink" href="home.html">Logout</a>

        <p class="headerP">Hello Toolbar</p>
    </div>

    <div class="mainDiv">
        
        <div id="d3Container"></div>
        <div id="d3SettingsContainerDiv">
            <p>Parameter for the Y-Axis</p>
            <select id=selectYDropDown>
                <option>petal_length</option>
                <option>petal_width</option>
                <option>sepal_length</option>
                <option>sepal_width</option>
            </select>
            <button id="generateTrendBtn" onclick="generateTrend()">Change Y Axis Parameter</button>
            <p>Parameter for the X-Axis</p>
            <select id=selectXDropDown>
                <option>petal_length</option>
                <option>petal_width</option>
                <option>sepal_length</option>
                <option>sepal_width</option>
            </select>
            <button id="generateTrendBtn" onclick="generateTrend()">Change X Axis Parameter</button>
            <p>Species Colour For Setosa</p>
            <input type="text" id="setosaColor">
            <button id="generateTrendBtn" onclick="generateTrend()">Change Colour</button>
            <p>Species Colour For Versicolor</p>
            <input type="text" id="versicolorColor">
            <button id="generateTrendBtn" onclick="generateTrend()">Change Colour</button>
            <p>Species Colour For Virginica</p>
            <input type="text" id="virginicaColor">
            <button id="generateTrendBtn" onclick="generateTrend()">Change Colour</button>
        </div>
    </div>
</body>

<script src="https://d3js.org/d3.v5.min.js"></script>
<script>
    

    generateTrend = function(){

        //this will be used to set what column to pick data from and how to label y axis
        let yDropDownInput = document.getElementById("selectYDropDown");
        let setosaColorInput = document.getElementById("setosaColor");
        let versicolorColorInput = document.getElementById("versicolorColor");
        let virginicaColorInput = document.getElementById("virginicaColor");

        let yParam = yDropDownInput.options[document.getElementById("selectYDropDown").selectedIndex].text;
        let xParam = yDropDownInput.options[document.getElementById("selectXDropDown").selectedIndex].text;

        let setosaColor = setosaColorInput.value;
        let versicolorColor = versicolorColorInput.value;
        let virginicaColor = virginicaColorInput.value;

        // create a list of keys to be used later for generating legend
        let keys = ["Setosa", "Versicolor", "Virginica"]

        //if any of the color fields are blank set default colours
        //should the user enter an unitelligible colour, fill defaults to black
        if(setosaColor === ""){
            setosaColor = "blue";
        }
        if(versicolorColor===""){
            versicolorColor = "green"
        }
        if(virginicaColor===""){
            virginicaColor = "red"
        }

        //if there's a preexisting svg remove contents then remove itself
        svgContainer = d3.selectAll("svg")
        svgContainer.selectAll("*").remove();
        svgContainer.remove();

        //load in the iris dataset
        var csvData=d3.csv("/data/IRIS.csv");

        //wanted to seperate lodaing in data then working with that but as of v5 of d3 this is closest I can get, trying to use csvData directly results in "promise" being returned so need to use .then(function(data)) to work with actual csv data
        //first with this I'm going to create a bar chart
        csvData.then(function(data){
            //console.log(data);
            
            

            //setting height and width for y and x scaling range
            var height = 400;
            var width = 550;

            var svgHeight = 450;
            var svgWidth = 600;
            //dataCount will be used to keep track of how many individual bar's will be needed
            var dataCount = data.length;
            var gap = 1; //gap of 1 pixel between bar's
            //console.log(dataCount);

            //my svgContainer is larger than the bar chart that will be within it
            var svgBarChart = d3.select("#d3Container").append("svg")
                .attr('width', svgWidth)
                .attr('height', svgHeight);

            var yScale = d3.scaleLinear()
                .domain([0,d3.max(data, function(d){
                    return (d[yParam]);
                })])
                .range([height,0]);

            var xScaleBar =d3.scaleBand()
                .domain([0,150])
                .range([0,width]);

            var xScaleScatter = d3.scaleLinear()
                .domain([0,d3.max(data, function(d){
                    return(d[xParam])
                })])
                .range([0,width]);

            var yAxis = d3.axisLeft()
                .scale(yScale);

            var xAxis = d3.axisBottom()
                .scale(xScaleBar);

            var xAxisScatter = d3.axisBottom()
                .scale(xScaleScatter);


            var barRectangles = svgBarChart.selectAll('rect')
                .data(data);

            barRectangles.enter()
                .append('rect')
                .attr("fill", "white")
                    .attr('x', function(g, i){
                        return 100;
                    })
                    .attr("width", 2000)
                    .transition()
                    .delay(1000)
                    .duration(2500)
                .attr('x', function(d, i){
                    return 50 + (i*(width/dataCount));
                    })
                .attr('y', function(d){
                    return yScale((d[yParam]));
                })
                .attr('width', 2)
                .attr('height', function(d){
                    return height - yScale(d[yParam]);
                })
                .attr('fill', function(d){
                    if(d.species.includes("setosa")) {return setosaColor;}
                    else if (d.species.includes("virginica")) {return virginicaColor;}
                    else if (d.species.includes("versicolor")) {return versicolorColor;}
                })
                .attr("transform", "translate(0,5)");

            svgBarChart.append("g")
                .attr("transform", "translate(48,5)")
                .call(yAxis);

            svgBarChart.append("text")             
              .attr("transform",
                    "translate(20," + (height/2) + ") rotate(-90)")
              .style("text-anchor", "middle")
              .text(yParam);

            svgBarChart.append("g")
                .attr("transform", "translate(48," + (height+5) + ")")
                .call(xAxis);

                // text label for the x axis
            svgBarChart.append("text")             
              .attr("transform",
                    "translate("+(width/2)+"," + (height +25) + ")")
              .style("text-anchor", "middle")
              .text("Species");

            // Add one dot in the legend for each name.
            svgBarChart.selectAll("mydots")
              .data(keys)
              .enter()
              .append("circle")
                .attr("cx", 90)
                .attr("cy", function(d,i){ return 20 + i*25}) // 100 is where the first dot appears. 25 is the distance between dots
                .attr("r", 7)
                .style("fill", function(d){ 
                    if(d==='Setosa'){return setosaColor;}
                    else if(d==='Virginica'){return virginicaColor;}
                    else if(d==='Versicolor'){return versicolorColor;}
                })

            // Add one dot in the legend for each name.
            svgBarChart.selectAll("mylabels")
              .data(keys)
              .enter()
              .append("text")
                .attr("x", 100)
                .attr("y", function(d,i){ return 25 + i*25}) // 100 is where the first dot appears. 25 is the distance between dots
                .style("fill", function(d){ 
                    if(d==='Setosa'){return setosaColor;}
                    else if(d==='Virginica'){return virginicaColor;}
                    else if(d==='Versicolor'){return versicolorColor;}
                })
                .text(function(d){ return d})
                .attr("text-anchor", "left")
                .style("alignment-baseline", "middle")

            //svgBarChart.attr("float","left")

            var svgScatter = d3.select("#d3Container").append("svg")
                .attr('width', svgWidth)
                .attr('height', svgHeight);

            // Add dots
            // using transform, translate here to offset by 5 on the y axis, this is to keep all dots within the visual and not half cut off
            svgScatter.selectAll("dot")
                .data(data)
                .enter()
                .append("circle")
                  .attr("cx", function (d) { return 48 +xScaleScatter(d.petal_width); } )
                  .attr("cy", function (d) { return yScale(d.petal_length); } )
                  .attr("r", 3)
                  .attr("transform", "translate(0,5)")
                  .style("fill", function(d){
                    if(d.species.includes("setosa")) {return setosaColor;}
                    else if (d.species.includes("virginica")) {return virginicaColor;}
                    else if (d.species.includes("versicolor")) {return versicolorColor;}

                });

            svgScatter.append("g")
                .attr("transform", "translate(48,5)")
                .call(yAxis);


            svgScatter.append("g")
                .attr("transform", "translate(48," + (height+5) + ")")
                .call(xAxisScatter);

            svgScatter.append("text")             
              .attr("transform",
                    "translate(15," + (height/2) + ") rotate(-90)")
              .style("text-anchor", "middle")
              .text(yParam);

            // text label for the x axis
            svgScatter.append("text")             
              .attr("transform",
                    "translate("+(width/2)+"," + (height+40) + ")")
              .style("text-anchor", "middle")
              .text(xParam);

            //svgScatter.attr("float","right")
            });
        
            
           


            

    }
    generateTrend();


</script>
</html>